<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Generator - Password Defender</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="Wayland.css">
  <style>
    body {font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:#eaeef8; background:#071026; padding:18px;}
    .section {background: rgba(255,255,255,0.03); padding:18px; border-radius:12px; max-width:900px; margin:18px auto;}
    input[type="number"] {width:80px; padding:8px; border-radius:8px; border:none; background: rgba(255,255,255,0.04); color:inherit;}
    label {display:block; margin-top:8px;}
    button {padding:10px 14px; border-radius:8px; border:none; background:#00f260; color:#000; cursor:pointer; font-weight:600;}
    .pw-box {background: rgba(0,0,0,0.25); padding:12px; border-radius:8px; margin-top:12px; font-family: monospace; font-size:1.05rem;}
    table {width:100%; border-collapse:collapse; margin-top:12px;}
    td, th {padding:8px; border-bottom:1px solid rgba(255,255,255,0.03);}
  </style>
</head>
<body>

  <div class="section">
    <h2>ðŸŽ² Password Generator (senza inserimento dati)</h2>

    <div style="display:flex; align-items:center; gap:12px;">
      <label>Lunghezza:
        <input id="len" type="number" min="4" max="64" value="12">
      </label>
      <label style="margin-left:6px;"><input id="useSymbols" type="checkbox" checked> Usa simboli</label>
      <button onclick="generate()">Genera</button>
      <button onclick="saveToLocal()">Salva in localStorage</button>
    </div>

    <div class="pw-box" id="pwBox">Password generata: <strong id="generatedPwd">â€”</strong></div>

    <h4>Stima durata per crack (stessi scenari)</h4>
    <table id="crackTable">
      <thead><tr><th>Scenario</th><th>VelocitÃ  (guess/s)</th><th>Tempo stimato</th></tr></thead>
      <tbody></tbody>
    </table>

  </div>

<script>
  function generatePassword(length=12, useSymbols=true){
    const lower = "abcdefghijklmnopqrstuvwxyz";
    const upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const digits = "0123456789";
    const symbols = "!@#$%^&*()-_=+[]{};:,.<>?/";
    let charset = lower + upper + digits;
    if (useSymbols) charset += symbols;
    let pwd = "";
    for (let i=0;i<length;i++){
      pwd += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    return pwd;
  }

  // reuse entropy & formatting helpers from Analyzer (embedded here)
  function detectPoolSize(pwd){
    let pool = 0;
    if (/[a-z]/.test(pwd)) pool += 26;
    if (/[A-Z]/.test(pwd)) pool += 26;
    if (/[0-9]/.test(pwd)) pool += 10;
    if (/[^A-Za-z0-9]/.test(pwd)) pool += 32;
    return pool || 1;
  }
  function entropyBits(pwd){ return pwd.length * Math.log2(detectPoolSize(pwd)); }
  function computeLog10Seconds(entropyBits, speed){ return entropyBits * Math.log10(2) - Math.log10(speed); }
  function formatTimeHuman(log10Seconds){
    if (!isFinite(log10Seconds)) return "âˆž";
    if (log10Seconds < Math.log10(1)) return "< 1 s";
    const sec = Math.pow(10, log10Seconds);
    if (sec < 60) return `${Math.round(sec)} secondi`;
    if (sec < 3600) return `${Math.round(sec/60)} minuti`;
    if (sec < 3600*24) return `${Math.round(sec/3600)} ore`;
    if (sec < 3600*24*365) return `${Math.round(sec/(3600*24))} giorni`;
    const years = sec / (3600*24*365);
    if (years < 1e3) return `${Math.round(years)} anni`;
    if (years < 1e6) return `${(years/1e3).toFixed(2)} mila anni`;
    if (years < 1e12) return `${(years/1e6).toFixed(2)} milioni di anni`;
    return `${(years/1e12).toFixed(2)} miliardi di milioni di anni`;
  }

  const scenarios = [
    {name:"Attacco online (modesto)", speed:1e3},
    {name:"Single CPU (offline)", speed:1e6},
    {name:"Single GPU (desktop)", speed:1e9},
    {name:"GPU rig (8 GPUs)", speed:1e10},
    {name:"Cluster / botnet", speed:1e13},
    {name:"Attacco massivo", speed:1e15}
  ];

  function updateCrackTable(pwd){
    const ent = entropyBits(pwd);
    const tbody = document.querySelector("#crackTable tbody");
    tbody.innerHTML = "";
    scenarios.forEach(s => {
      const log10Sec = computeLog10Seconds(ent, s.speed);
      const human = formatTimeHuman(log10Sec);
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${s.name}</td><td>${s.speed.toExponential().replace('+','')}</td><td>${human}</td>`;
      tbody.appendChild(tr);
    });
  }

  function generate(){
    const len = parseInt(document.getElementById("len").value,10) || 12;
    const useSymbols = document.getElementById("useSymbols").checked;
    const pwd = generatePassword(len, useSymbols);
    document.getElementById("generatedPwd").textContent = pwd;
    updateCrackTable(pwd);
  }

  function saveToLocal(){
    const pwd = document.getElementById("generatedPwd").textContent;
    if (!pwd || pwd === "â€”") { alert("Genera prima una password."); return; }
    try{
      const existing = JSON.parse(localStorage.getItem("userData")) || {};
      existing.password = pwd;
      localStorage.setItem("userData", JSON.stringify(existing));
      alert("Password salvata in localStorage (userData.password).");
    }catch(e){
      alert("Errore nel salvare in localStorage.");
    }
  }

  // init sample
  (function init(){ generate(); })();
</script>

</body>
</html>
